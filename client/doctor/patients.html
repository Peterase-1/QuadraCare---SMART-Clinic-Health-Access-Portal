<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Patients - QuadraCare</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="../css/style.css">
</head>

<body>
  <div class="dashboard-layout">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <i class="fa-solid fa-heart-pulse"></i> QuadraCare
        <button class="close-sidebar"><i class="fa-solid fa-xmark"></i></button>
      </div>
      <nav class="sidebar-nav">
        <a href="dashboard.html" class="nav-link">
          <i class="fa-solid fa-house"></i> Dashboard
        </a>
        <a href="appointments.html" class="nav-link">
          <i class="fa-solid fa-calendar-check"></i> Appointments
        </a>
        <a href="patients.html" class="nav-link active">
          <i class="fa-solid fa-user-injured"></i> Patients
        </a>
        <a href="#" id="logoutBtn" class="nav-link" style="margin-top: auto;">
          <i class="fa-solid fa-right-from-bracket"></i> Logout
        </a>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <header class="top-bar">
        <div>
          <button class="hamburger-menu"><i class="fa-solid fa-bars"></i></button>
        </div>
        <div class="user-profile">
          <div class="text-right">
            <h4 id="userName" style="font-size: 1rem; margin:0;">Dr. Name</h4>
            <span style="font-size: 0.8rem; color: var(--text-secondary);">General Physician</span>
          </div>
          <div class="avatar"><i class="fa-solid fa-user-doctor"></i></div>
        </div>
      </header>

      <div class="container-fluid">
        <div class="responsive-grid" style="grid-template-columns: 1fr 2fr;">
          <!-- Pending Reviews -->
          <div class="card">
            <h3 style="margin-bottom: 1.5rem;">Pending Reviews & Active Cases</h3>
            <div id="reviewsList" style="display: grid; gap: 1rem;">
              <p>Loading active cases...</p>
            </div>
          </div>

          <!-- Patients List -->
          <div>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
              <h3 style="margin: 0;">Patient Directory</h3>
              <input type="text" id="patientSearch" placeholder="Search patients..." class="form-input"
                style="width: 250px;">
            </div>
            <div id="patientsList"
              style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 1.5rem;">
              <p>Loading patients...</p>
            </div>
            <div style="text-align: center; margin-top: 1.5rem;">
              <button id="loadMorePatientsBtn" class="btn btn-outline" style="display: none;">Load More</button>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- History Modal -->
  <div id="historyModal" class="modal" style="display: none;">
    <div class="modal-content modal-lg">
      <div class="modal-header">
        <h2 class="modal-title">Medical History</h2>
        <button type="button" class="modal-close" onclick="closeHistoryModal()">&times;</button>
      </div>
      <div id="historyContent">
        <p>Loading history...</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" onclick="closeHistoryModal()">Close</button>
      </div>
    </div>
  </div>

  <!-- Finalize Consultation Modal -->
  <div id="finalizeModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 800px;">
      <div class="modal-header">
        <h2 class="modal-title">Finalize Consultation</h2>
        <button type="button" class="modal-close" onclick="closeFinalizeModal()">&times;</button>
      </div>
      <form id="finalizeForm">
        <input type="hidden" id="finalizeRecordId">

        <!-- Lab Results Section -->
        <div id="labResultsSection"
          style="margin-bottom: 1.5rem; padding: 1rem; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0; display: none;">
          <h4 style="margin-top: 0; color: var(--primary-color);">Lab Results</h4>
          <p id="displayLabResults"
            style="white-space: pre-wrap; font-family: monospace; background: #fff; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
          </p>
          <p id="displayLabComments" style="color: var(--text-secondary); font-style: italic; margin-top: 0.5rem;"></p>
        </div>

        <div class="form-group">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
            <label class="form-label" style="margin-bottom: 0;">Final Diagnosis</label>
            <button type="button" class="btn btn-sm btn-outline" onclick="askAI()"
              style="color: #7c3aed; border-color: #7c3aed;">
              <i class="fa-solid fa-wand-magic-sparkles"></i> Ask AI Suggestion
            </button>
          </div>
          <input type="text" id="finalDiagnosis" class="form-input" required>
        </div>

        <div class="form-group">
          <label class="form-label">Prescription</label>
          <div id="medicineList">
            <!-- Medicine items will be added here -->
            <div class="medicine-row" style="margin-bottom: 1rem; border-bottom: 1px solid #eee; padding-bottom: 1rem;">
              <div class="medicine-grid">
                <input type="text" class="form-input med-name" placeholder="Medicine Name" required>
                <input type="text" class="form-input med-dosage" placeholder="Dosage" required>
                <input type="text" class="form-input med-freq" placeholder="Freq" required>
                <input type="text" class="form-input med-dur" placeholder="Duration" required>
                <input type="text" class="form-input med-route" placeholder="Route (Oral)" required>
                <input type="text" class="form-input med-timing" placeholder="Timing (After Meal)" required>
              </div>
              <div class="medicine-notes">
                <input type="text" class="form-input med-notes" placeholder="Notes (Optional)"
                  style="font-size: 0.9rem;">
              </div>
            </div>
          </div>
          <button type="button" class="btn btn-outline" onclick="addMedicineRow()"
            style="width: 100%; margin-top: 0.5rem; font-size: 0.85rem;">
            <i class="fa-solid fa-plus"></i> Add Another Medicine
          </button>
        </div>

        <div class="form-group">
          <label class="form-label">Instructions</label>
          <textarea id="finalInstructions" class="form-input" rows="2"></textarea>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-outline" onclick="closeFinalizeModal()">Cancel</button>
          <button type="submit" class="btn btn-primary">Finalize & Print</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Print Preview Modal -->
  <div id="printModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 800px;">
      <div class="modal-header">
        <h2 class="modal-title">Prescription Preview</h2>
        <button type="button" class="modal-close" onclick="closePrintModal()">&times;</button>
      </div>
      <div id="printArea" style="padding: 2rem; border: 1px solid #ddd; margin-bottom: 1.5rem;">
        <!-- Prescription Content -->
      </div>
      <div class="modal-footer" style="justify-content: space-between;">
        <button type="button" class="btn btn-outline" onclick="closePrintModal()">Close Preview</button>
        <div style="display: flex; gap: 1rem;">
          <button type="button" class="btn btn-primary" onclick="printPrescription()">
            <i class="fa-solid fa-print"></i> Print PDF
          </button>
          <button type="button" class="btn btn-success" onclick="closeCase()"
            style="background-color: #10b981; border-color: #10b981; color: white;">
            <i class="fa-solid fa-check"></i> Close Case
          </button>
        </div>
      </div>
    </div>
  </div>

  <script src="../js/utils.js"></script>
  <script src="../js/doctor.js"></script>
  <script>
    function closeFinalizeModal() {
      const modal = document.getElementById('finalizeModal');
      modal.classList.remove('show');
      setTimeout(() => { modal.style.display = 'none'; }, 300);
    }
    function closePrintModal() {
      const modal = document.getElementById('printModal');
      modal.classList.remove('show');
      setTimeout(() => { modal.style.display = 'none'; }, 300);
    }
    function closeHistoryModal() {
      const modal = document.getElementById('historyModal');
      modal.classList.remove('show');
      setTimeout(() => { modal.style.display = 'none'; }, 300);
    }
    function addMedicineRow() {
      const container = document.createElement('div');
      container.innerHTML = `
        <div class="medicine-row" style="margin-bottom: 1rem; border-bottom: 1px solid #eee; padding-bottom: 1rem;">
            <div class="medicine-grid">
                <input type="text" class="form-input med-name" placeholder="Medicine Name" required>
                <input type="text" class="form-input med-dosage" placeholder="Dosage" required>
                <input type="text" class="form-input med-freq" placeholder="Freq" required>
                <input type="text" class="form-input med-dur" placeholder="Duration" required>
                <input type="text" class="form-input med-route" placeholder="Route (Oral)" required>
                <input type="text" class="form-input med-timing" placeholder="Timing (After Meal)" required>
            </div>
            <div class="medicine-notes">
                <input type="text" class="form-input med-notes" placeholder="Notes (Optional)" style="font-size: 0.9rem;">
            </div>
        </div>
      `;
      document.getElementById('medicineList').appendChild(container);
    }
    function printPrescription() {
      const printContent = document.getElementById('printArea').innerHTML;
      const originalContent = document.body.innerHTML;

      document.body.innerHTML = printContent;
      window.print();
      document.body.innerHTML = originalContent;
      window.location.reload();
    }
  </script>

  <script src="../js/sidebar.js"></script>
</body>

</html>