<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Patients - QuadraCare</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="../css/style.css">
</head>

<body>
  <div class="dashboard-layout">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <i class="fa-solid fa-heart-pulse"></i> QuadraCare
      </div>
      <nav class="sidebar-nav">
        <a href="dashboard.html" class="nav-link">
          <i class="fa-solid fa-house"></i> Dashboard
        </a>
        <a href="appointments.html" class="nav-link">
          <i class="fa-solid fa-calendar-check"></i> Appointments
        </a>
        <a href="patients.html" class="nav-link active">
          <i class="fa-solid fa-user-injured"></i> Patients
        </a>
        <a href="#" id="logoutBtn" class="nav-link" style="margin-top: auto;">
          <i class="fa-solid fa-right-from-bracket"></i> Logout
        </a>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <header class="top-bar">
        <div></div>
        <div class="user-profile">
          <div class="text-right">
            <h4 id="userName" style="font-size: 1rem; margin:0;">Dr. Name</h4>
          </div>
          <div class="avatar"><i class="fa-solid fa-user-doctor"></i></div>
        </div>
      </header>

      <div class="container-fluid">
        <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 2rem;">
          <!-- Pending Reviews -->
          <div class="card">
            <h3 style="margin-bottom: 1.5rem;">Pending Reviews & Active Cases</h3>
            <div id="reviewsList" style="display: grid; gap: 1rem;">
              <p>Loading active cases...</p>
            </div>
          </div>

          <!-- Patients List -->
          <div>
            <h3 style="margin-bottom: 1rem;">Patient Directory</h3>
            <div id="patientsList" style="display: grid; gap: 1rem;">
              <p>Loading patients...</p>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Finalize Consultation Modal -->
  <div id="finalizeModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 800px;">
      <div class="modal-header">
        <h2 class="modal-title">Finalize Consultation</h2>
        <button type="button" class="modal-close" onclick="closeFinalizeModal()">&times;</button>
      </div>
      <form id="finalizeForm">
        <input type="hidden" id="finalizeRecordId">

        <!-- Lab Results Display -->
        <div class="form-group" style="margin-bottom: 1.5rem; background: #f8fafc; padding: 1rem; border-radius: 12px;">
          <label class="form-label" style="color: var(--primary-color);">Lab Results</label>
          <p id="displayLabResults" style="white-space: pre-wrap; margin-bottom: 0.5rem; font-weight: 500;">No
            results available.</p>
          <p id="displayLabComments" style="font-size: 0.9rem; color: var(--text-secondary); font-style: italic;"></p>
        </div>

        <div class="form-section-title">Diagnosis & Treatment</div>
        <div class="form-group">
          <label class="form-label">Final Diagnosis</label>
          <input type="text" id="finalDiagnosis" class="form-input" required>
        </div>

        <div class="form-group">
          <label class="form-label">Prescription</label>
          <div id="medicineList">
            <!-- Medicine items will be added here -->
            <div class="medicine-item"
              style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 1fr 1fr; gap: 0.5rem; margin-bottom: 0.5rem; align-items: start;">
              <input type="text" class="form-input med-name" placeholder="Medicine Name" required>
              <input type="text" class="form-input med-dosage" placeholder="Dosage" required>
              <input type="text" class="form-input med-freq" placeholder="Freq" required>
              <input type="text" class="form-input med-dur" placeholder="Duration" required>
              <input type="text" class="form-input med-route" placeholder="Route (Oral)" required>
              <input type="text" class="form-input med-timing" placeholder="Timing (After Meal)" required>
            </div>
            <div class="medicine-notes" style="margin-bottom: 1rem;">
              <input type="text" class="form-input med-notes" placeholder="Notes (Optional)" style="font-size: 0.9rem;">
            </div>
          </div>
          <button type="button" class="btn btn-outline" onclick="addMedicineRow()"
            style="width: 100%; margin-top: 0.5rem; font-size: 0.85rem;">
            <i class="fa-solid fa-plus"></i> Add Another Medicine
          </button>
        </div>

        <div class="form-group">
          <label class="form-label">Instructions</label>
          <textarea id="finalInstructions" class="form-input" rows="2"></textarea>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-outline" onclick="closeFinalizeModal()">Cancel</button>
          <button type="submit" class="btn btn-primary">Finalize & Print</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Print Preview Modal -->
  <div id="printModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 800px;">
      <div class="modal-header">
        <h2 class="modal-title">Prescription Preview</h2>
        <button type="button" class="modal-close" onclick="closePrintModal()">&times;</button>
      </div>
      <div id="printArea" style="padding: 2rem; border: 1px solid #ddd; margin-bottom: 1.5rem;">
        <!-- Prescription Content -->
      </div>
      <div class="modal-footer" style="justify-content: space-between;">
        <button type="button" class="btn btn-outline" onclick="closePrintModal()">Close Preview</button>
        <div style="display: flex; gap: 1rem;">
          <button type="button" class="btn btn-primary" onclick="printPrescription()">
            <i class="fa-solid fa-print"></i> Print PDF
          </button>
          <button type="button" class="btn btn-success" onclick="closeCase()"
            style="background-color: #10b981; border-color: #10b981; color: white;">
            <i class="fa-solid fa-check"></i> Close Case
          </button>
        </div>
      </div>
    </div>
  </div>

  <script src="../js/doctor.js"></script>
  <script>
    function closeFinalizeModal() {
      const modal = document.getElementById('finalizeModal');
      modal.classList.remove('show');
      setTimeout(() => { modal.style.display = 'none'; }, 300);
    }
    function closePrintModal() {
      const modal = document.getElementById('printModal');
      modal.classList.remove('show');
      setTimeout(() => { modal.style.display = 'none'; }, 300);
    }
    function addMedicineRow() {
      const container = document.createElement('div');
      container.innerHTML = `
        <div class="medicine-item"
            style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 1fr 1fr; gap: 0.5rem; margin-bottom: 0.5rem; align-items: start;">
            <input type="text" class="form-input med-name" placeholder="Medicine Name" required>
            <input type="text" class="form-input med-dosage" placeholder="Dosage" required>
            <input type="text" class="form-input med-freq" placeholder="Freq" required>
            <input type="text" class="form-input med-dur" placeholder="Duration" required>
            <input type="text" class="form-input med-route" placeholder="Route (Oral)" required>
            <input type="text" class="form-input med-timing" placeholder="Timing (After Meal)" required>
        </div>
        <div class="medicine-notes" style="margin-bottom: 1rem;">
            <input type="text" class="form-input med-notes" placeholder="Notes (Optional)" style="font-size: 0.9rem;">
        </div>
      `;
      document.getElementById('medicineList').appendChild(container);
    }
    function printPrescription() {
      const printContent = document.getElementById('printArea').innerHTML;
      const originalContent = document.body.innerHTML;

      document.body.innerHTML = printContent;
      window.print();
      document.body.innerHTML = originalContent;
      // Re-bind events or reload? Reload is safest but loses state. 
      // Since we have a Close Case button now, maybe we don't want to reload immediately.
      // But replacing body.innerHTML destroys event listeners.
      // Better approach for printing: open new window or use iframe.
      // For now, let's just reload to be safe, but this means "Close Case" must be clicked BEFORE or AFTER?
      // If we reload, the modal is gone.
      // Let's try to restore without reload if possible, or just accept reload.
      // Actually, standard practice is to print and then stay on page.
      // If I replace body, I lose everything.
      // Let's use a simple print trick: @media print css.
      // But the user's code used innerHTML replacement.
      // I will stick to reload for now, but this makes "Close Case" tricky if they print first.
      // Wait, if they print, the page reloads, so they have to open the modal again? No, the modal was for preview.
      // If they print, they likely want to close the case after.
      // I will change print logic to NOT destroy the page.
      window.location.reload();
    }
  </script>

</body>

</html>